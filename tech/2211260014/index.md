---
layout: post
type: tech
date: 2022-11-26 00:14
category: Blog
title: AWS EC2 요금 폭탄 정산 후기
subtitle: 불법 해킹으로인한 3,700만원의 AWS 요금 폭탄 해결기
writer: KimYC1223
post-header: true
image: /img/title.png
header-img: /tech/2211260014/img/bg.png
hash-tag: [ToyProject]
draft : true
---

## 바쁘다 바빠 현대사회인을 위한 요약

아마 이 글을 읽고 있는 분은 엄청난 요금 폭탄으로 긴 글을 읽을 정신이 없을것이다.

그런 당신을 위해, 이 문제에 대한 나의 조언은 다음과 같다.

📌 지금 당장 AWS 고객센터에 문의하라. 시간이 늦어질수록 당신이 불리해진다.

📌 AWS는 이런 문제에 대해 자주 대응하고 있다고 한다. 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;본인은 당황스러울 수 있으나 생각보다 자주 일어나는 일이고 다들 잘 해결을 하고 있으니, 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;너무 걱정하지 않아도 된다. 특히 이 문제는 해결하는데 한달 이상이 소요되므로

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;멘탈을 잘 붙잡고 버티는것이 중요하다.

📌 문제가 발생한 즉시 조치하면 정말 큰 금액도 해결 할 수 있지만, 몇 개월 이상 방치했다면... 해결이 어려워진다고 한다.

📌 AWS에서 답장을 줄 때 신속하게 대응 할 수 있도록, 메일을 자주 확인해야한다.

📌 이런 일이 일어나지 않도록 [MFA](https://ko.wikipedia.org/wiki/다요소_인증)와 같은 보안 설정을 철저히 한다.

<br>

---

## 새벽에 날라온 AWS의 고지서

평소와 다를 바 없던 10월 3일 새벽, 공포는 소리없이 내게 찾아왔다.

![AWS 3700만원 문자 메세지](./img/img_1.png)

누워서 자고있던 도중, 한 통의 문자가 도착했다.

평소 석사 졸업 연구 프로젝트에 관한 서버와 개인용 웹서버 & 게임 서버를 운용하기 위해 사용중이던 AWS에서 요금 정산 메시지가 온 것이다.

여러 서버를 사용중이었기에, 한달에 대략 5만원 ~ 7만원 가량의 요금이 나왔는데, 새벽에 문자가와서 확인해보니

이번달은 ```3만 7천원```의 요금이 나와있었다.

```'어..? 그런데 왜 한도 초과라고 하는거지?'``` 라고 생각하며 다시 확인해보니...


![놀라는 짤방](./img/img_2.gif)

<center><span style="color:red; margin-top:-15px">3만 7천원이 아니라 3,700만원 이라는 요금이 부과되었다.</span></center>

<br>

이.... 이 무슨... 심각한 사태임을 직감한 나는 바로 일어나 컴퓨터를 켜고 확인에 나섰다.

AWS에 가입한 메일로 영수증 관련된 메일이 온 것을 확인했는데, 자세히 확인해보니 다음과 같은 내역을 볼 수 있었다.

![3,700만원 영수증](./img/img_4.png)

AWS의 웹 대시보드 중 ```Billing```페이지에 가 보면 자세한 청구 내역을 확인할 수 있다.

내 요금 중 가장 큰 포션을 차지하는것은 ```p3.16xlarge```를 대여한 비용이었다.

```p3.16xlarge``` 인스턴스?? 이게 도대체 뭐지? 이름부터 뭔가 불길한데..?

![p3.16xlarge 설명](./img/img_5.png)

확인해보니, 64코어 CPU에 500GB 메모리라는 엄청난 성능의 윈도우 서버를 대여하고 있었다.

며칠 전(9월 말)에 아는 동생이 멀티 게임 서버를 열어달라고 하여, 새로 EC2 인스턴스를 구매하고 게임 서버를 열어준 적이 있는데,

혹시나 내가 잘못보고 ```인스턴스 유형을 잘못 선택한게 아닐까?``` 라는 생각을 했다.

그런데 더 확인해 알아본 결과, 이 정신나간 인스턴스는 9월 4일 새벽 3시부터 가동을 시작했다는 것을 알게되었다.

문제는 내가 분명한 기억하건데, 근 한달동안 새벽에 AWS 서버 작업을 한 기억이 없거니와,

특히나 9월 4일은 저녁 먹은게 체해서 이른 저녁부터 소화제를 먹고 앓아 누워있던 밤이었다.

![놀라서 뒤집어지는 짤방](./img/img_3.gif)

<center><span style="color:red;">여기서부터 내 AWS계정이 해킹당했음을 직감했다.</span></center>

<br>
