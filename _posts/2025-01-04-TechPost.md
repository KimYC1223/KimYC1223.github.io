---
layout: post
pagination: 
  enabled: true
type: tech
date: 2025-01-04 17:40
category: Blog
title: "유니티 프로파일러(Unity Profiler)를 사용한 URP 최적화 작업 기록 일지"
subtitle: 구형 Android에서 FPS를 끌어 올리기위한 사투를 기록했다
writer: KimYC1223
post-header: true
header-img: bg.png
image: title.png
tags: [Unity]
draft : false
---

{% capture img_url %}/assets/blog/{{page.date | date: "%Y-%m-%d"}}-TechPost{% endcapture %}

토이 프로젝트로 진행하고 있는 프로젝트에서, Unity Profiler를 통해 최적화를 연구했던 내용을 공유하고자 한다.

<br><br>

---

# 🔷 시작

## 🔶 프레임 드랍이 너무 심해!

 현재 클라이언트 개발자로 참여하고 있는 토이 프로젝트 <span class="post-highlight">엄마찾아 탕탕탕!</span> 프로젝트를 진행하던 도중, PC Editor 환경에서는 큰 문제가 없으나 빌드 후 모바일 환경에서는 FPS가 너무 심해 게임을 정상적으로 플레이 할 수 없다는 제보를 받았다.

 <br />

 이 말이 사실인지 확인하기 위해 직접 빌드를 돌려 테스트 해보려 했지만, 개인 휴대폰인 `IPhone 13 Pro Max` 에서는 무리 없이 부드럽게 게임이 돌아가는 모습을 확인했다.

 따라서 해당 이슈를 제시해주셨던 팀장님께 어떤 기종인지 확인해본 결과, 해당 이슈가 발생하는 디바이스는 퍼포먼스가 상당히 떨어지는 구형 안드로이드 모바일 기기였다.

 <br />

 논의 결과, 해당 디바이스를 최소 사양으로 정하고 진행했으면 좋겠다는 의견이 있었기에 일단 급한대로 주변에서 구형 안드로이드 기기를 구해보기로 했다.

<center>
<img src="{{img_url}}/01_GalaxyTabA7.jpg" style="width:600px">
<figcaption style="margin-top:-20px;">주변에서 어렵사리 구한 Galaxy Tab A7</figcaption>
</center>

<br />

 구한 테스트 디바이스는 <span class="post-highlight">Galaxt Tab A7</span>이다. 아래는 Galaxy Tab A7의 하드웨어 스펙이다.

<center>
<img src="{{img_url}}/01_GalaxyTabA7_Spec.png" style="width:647px">
<figcaption style="margin-top:-20px;">Galaxy Tab A7 기기 스펙</figcaption>
</center>

<br />

 테스트를 시작해보자

<br /><br />

 ---

# 🔷 테스트 진행

## 🔶 안드로이드에서 빌드 후 테스트

 프로젝트를 빌드 후, 해당 기기에서 테스트를 진행하자 충격적인 사실을 마주했다.

<center>
<img src="{{img_url}}/01_Origin.jpg" style="width:600px">
<figcaption style="margin-top:-20px;">평균 FPS : 7</figcaption>
</center>

 GIF 수준으로 끊겨서 보이는 것을 확인했다. 이 정도면 정상적인 게임 진행 플레이는 커녕 캐릭터 조작도 어려울 지경이었다. 액션 슈팅 아케이드 게임인 본 프로젝트에서 이 정도 FPS는 너무 처참한 결과였다.

 일단 USB 케이블로 PC와 디바이스를 연결한 후, [Unity Profiler](https://docs.unity3d.com/kr/2022.3/Manual/Profiler.html)를 사용하여 분석에 들어갔다. 연결 후 디버깅을 해보니, 다음과 같은 모습을 확인할 수 있었다.

<center>
<img src="{{img_url}}/01_Origin_Profile.png" style="width:950px">
<figcaption style="margin-top:-20px;">Gfx.WaitForPresentOnGfxThread</figcaption>
</center>

프로파일러를 보니 무려 `Gfx.WaitForPresentOnGfxThread` 라는 항목에서 엄청난 시간을 소비하고 있다는 것을 알았다.

전지전능하신 [Unity Korea의 유튜브 가이드](https://youtu.be/o3o7fVCV4OA?si=GiVLGBpM5PszfTxW&t=218)에 따르면, 최적화의 첫 시작은 바로 지금 발생하는 이슈가 `CPU 바운드` 인지, `GPU 바운드` 인지를 파악하는 것이라고 한다.

<br />

> ### ❓ GPU 바운드 vs CPU 바운드
>
> **한 줄 요약 :**
>
> * <span clas="post-highlight">CPU 바운드</span> : GPU는 일이 없어 널널한데, CPU가 너무 바빠서 프레임 드랍이 발생하는 현상
> * <span clas="post-highlight">GPU 바운드</span> : CPU는 일이 없어 널널한데, GPU가 너무 바빠서 프레임 드랍이 발생하는 현상

<br />

현재 상황이 **CPU 바운드** 냐, **GPU 바운드** 냐에 따라 최적화 전략이 결정되므로, 엄청난 시간이 소요되고 있는 `Gfx.WaitForPresentOnGfxThread` 연산이 어떤 종류의 바운드인지를 먼저 검색해 보았다.

<br />

> 📚 **참고자료**  : 
> 
> * [ Unity Korea . [유니티 TIPS] 알쓸유잡 \| 병목 (Bottleneck) - CPU vs GPU, 메모리. 최적화 및 프로파일링 팁](https://youtu.be/o3o7fVCV4OA?si=GiVLGBpM5PszfTxW)

<br /><br />

## 🔶 안드로이드에서 빌드 후 테스트